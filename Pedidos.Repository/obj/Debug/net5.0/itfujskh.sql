CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "tbl_CategoriaProduto" (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(50) NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_CategoriaProduto" PRIMARY KEY (id)
);

CREATE TABLE tbl_cidade (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(100) NOT NULL,
    uf character varying(2) NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_cidade" PRIMARY KEY (id)
);

CREATE TABLE tbl_imagem (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(20) NOT NULL,
    "nomeArquivo" character varying(20) NOT NULL,
    principal boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_imagem" PRIMARY KEY (id)
);

CREATE TABLE tbl_produto (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(50) NOT NULL,
    codigo character varying(50) NOT NULL,
    descricao character varying(100) NOT NULL,
    preco numeric(17,2) NOT NULL,
    categoriaid integer NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_produto" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_produto_tbl_CategoriaProduto_categoriaid" FOREIGN KEY (categoriaid) REFERENCES "tbl_CategoriaProduto" (id) ON DELETE CASCADE
);

CREATE TABLE tbl_endereco (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    tipo smallint NOT NULL,
    logradouro character varying(50) NOT NULL,
    bairro character varying(50) NOT NULL,
    numero character varying(10) NULL,
    complemento character varying(50) NULL,
    cep character varying(8) NULL,
    cidadeid integer NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_endereco" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_endereco_tbl_cidade_cidadeid" FOREIGN KEY (cidadeid) REFERENCES tbl_cidade (id) ON DELETE CASCADE
);

CREATE TABLE tbl_combo (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(50) NOT NULL,
    preco numeric(17,2) NOT NULL,
    imagemid integer NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_combo" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_combo_tbl_imagem_imagemid" FOREIGN KEY (imagemid) REFERENCES tbl_imagem (id) ON DELETE CASCADE
);

CREATE TABLE "tbl_ImagemProduto" (
    imagemid integer NOT NULL,
    produtoid integer NOT NULL,
    CONSTRAINT "PK_tbl_ImagemProduto" PRIMARY KEY (imagemid, produtoid),
    CONSTRAINT "FK_tbl_ImagemProduto_tbl_imagem_imagemid" FOREIGN KEY (imagemid) REFERENCES tbl_imagem (id) ON DELETE CASCADE,
    CONSTRAINT "FK_tbl_ImagemProduto_tbl_produto_produtoid" FOREIGN KEY (produtoid) REFERENCES tbl_produto (id) ON DELETE CASCADE
);

CREATE TABLE tbl_promocao_produto (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(50) NOT NULL,
    preco numeric(17,2) NOT NULL,
    imagemid integer NOT NULL,
    produtoid integer NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_promocao_produto" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_promocao_produto_tbl_imagem_imagemid" FOREIGN KEY (imagemid) REFERENCES tbl_imagem (id) ON DELETE CASCADE,
    CONSTRAINT "FK_tbl_promocao_produto_tbl_produto_produtoid" FOREIGN KEY (produtoid) REFERENCES tbl_produto (id) ON DELETE CASCADE
);

CREATE TABLE tbl_cliente (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    nome character varying(100) NOT NULL,
    cpf character varying(50) NOT NULL,
    enderecoid integer NOT NULL,
    ativo boolean NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_cliente" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_cliente_tbl_endereco_enderecoid" FOREIGN KEY (enderecoid) REFERENCES tbl_endereco (id) ON DELETE CASCADE
);

CREATE TABLE "tbl_ProdutoCombo" (
    produtoid integer NOT NULL,
    comboid integer NOT NULL,
    CONSTRAINT "PK_tbl_ProdutoCombo" PRIMARY KEY (produtoid, comboid),
    CONSTRAINT "FK_tbl_ProdutoCombo_tbl_combo_comboid" FOREIGN KEY (comboid) REFERENCES tbl_combo (id) ON DELETE CASCADE,
    CONSTRAINT "FK_tbl_ProdutoCombo_tbl_produto_produtoid" FOREIGN KEY (produtoid) REFERENCES tbl_produto (id) ON DELETE CASCADE
);

CREATE TABLE tbl_pedido (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    numero character varying(10) NOT NULL,
    "valorTotal" numeric(17,2) NOT NULL,
    entrega interval NOT NULL,
    clienteid integer NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_pedido" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_pedido_tbl_cliente_clienteid" FOREIGN KEY (clienteid) REFERENCES tbl_cliente (id) ON DELETE CASCADE
);

CREATE TABLE tbl_produto_pedido (
    id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    quantidade integer NOT NULL,
    preco numeric(17,2) NOT NULL,
    produtoid integer NOT NULL,
    pedidoid integer NOT NULL,
    criadoem timestamp without time zone NOT NULL,
    CONSTRAINT "PK_tbl_produto_pedido" PRIMARY KEY (id),
    CONSTRAINT "FK_tbl_produto_pedido_tbl_pedido_pedidoid" FOREIGN KEY (pedidoid) REFERENCES tbl_pedido (id) ON DELETE CASCADE,
    CONSTRAINT "FK_tbl_produto_pedido_tbl_produto_produtoid" FOREIGN KEY (produtoid) REFERENCES tbl_produto (id) ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_tbl_cliente_enderecoid" ON tbl_cliente (enderecoid);

CREATE INDEX "IX_tbl_combo_imagemid" ON tbl_combo (imagemid);

CREATE INDEX "IX_tbl_endereco_cidadeid" ON tbl_endereco (cidadeid);

CREATE INDEX "IX_tbl_ImagemProduto_produtoid" ON "tbl_ImagemProduto" (produtoid);

CREATE INDEX "IX_tbl_pedido_clienteid" ON tbl_pedido (clienteid);

CREATE INDEX "IX_tbl_produto_categoriaid" ON tbl_produto (categoriaid);

CREATE INDEX "IX_tbl_produto_pedido_pedidoid" ON tbl_produto_pedido (pedidoid);

CREATE INDEX "IX_tbl_produto_pedido_produtoid" ON tbl_produto_pedido (produtoid);

CREATE INDEX "IX_tbl_ProdutoCombo_comboid" ON "tbl_ProdutoCombo" (comboid);

CREATE INDEX "IX_tbl_promocao_produto_imagemid" ON tbl_promocao_produto (imagemid);

CREATE INDEX "IX_tbl_promocao_produto_produtoid" ON tbl_promocao_produto (produtoid);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20210207224512_Init', '5.0.2');

COMMIT;

